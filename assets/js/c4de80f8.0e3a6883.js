"use strict";(self.webpackChunkkube_green_github_io=self.webpackChunkkube_green_github_io||[]).push([[943],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return h}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=r.createContext({}),p=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=p(e.components);return r.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),d=p(n),h=o,m=d["".concat(u,".").concat(h)]||d[h]||c[h]||a;return n?r.createElement(m,l(l({ref:t},s),{},{components:n})):r.createElement(m,l({ref:t},s))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=d;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<a;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7520:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return u},metadata:function(){return p},toc:function(){return s},default:function(){return d}});var r=n(3117),o=n(102),a=(n(7294),n(3905)),l=["components"],i={sidebar_position:3},u="Install",p={unversionedId:"install",id:"install",title:"Install",description:"Prerequisite",source:"@site/docs/install.md",sourceDirName:".",slug:"/install",permalink:"/docs/install",editUrl:"https://github.com/kube-green/kube-green.github.io/edit/main/docs/install.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"How it works",permalink:"/docs/lifecycle"},next:{title:"Configuration",permalink:"/docs/configuration"}},s=[{value:"Prerequisite",id:"prerequisite",children:[],level:2},{value:"kubectl apply",id:"kubectl-apply",children:[],level:2},{value:"kustomize",id:"kustomize",children:[{value:"Change default configuration",id:"change-default-configuration",children:[],level:3},{value:"Deploy",id:"deploy",children:[],level:3}],level:2},{value:"Operator Lifecycle Manager (OLM)",id:"operator-lifecycle-manager-olm",children:[{value:"Install from OperatorHub.io",id:"install-from-operatorhubio",children:[],level:3},{value:"Install on OpenShift",id:"install-on-openshift",children:[],level:3}],level:2},{value:"Cloud compatibility",id:"cloud-compatibility",children:[{value:"GKE",id:"gke",children:[],level:3},{value:"AWS EKS",id:"aws-eks",children:[],level:3}],level:2}],c={toc:s};function d(e){var t=e.components,n=(0,o.Z)(e,l);return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"install"},"Install"),(0,a.kt)("h2",{id:"prerequisite"},"Prerequisite"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"kube-green")," support all cluster versions >= 1.19 <= 1.23."),(0,a.kt)("p",null,"To successfully install ",(0,a.kt)("em",{parentName:"p"},"kube-green"),", in the cluster must be installed a ",(0,a.kt)("strong",{parentName:"p"},"cert-manager"),". If it is not already installed installed, ",(0,a.kt)("a",{parentName:"p",href:"https://cert-manager.io/docs/installation/"},"click here"),"."),(0,a.kt)("h2",{id:"kubectl-apply"},"kubectl apply"),(0,a.kt)("p",null,"With this method, you can not change the default configuration parameters."),(0,a.kt)("p",null,"The default static configuration for the latest release can be installed with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl apply -f https://github.com/kube-green/kube-green/releases/latest/download/kube-green.yaml\n")),(0,a.kt)("p",null,"If you want to install a specific release version, run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl apply -f https://github.com/kube-green/kube-green/releases/download/${RELEASE_TAG}/kube-green.yaml\n")),(0,a.kt)("p",null,"with ",(0,a.kt)("inlineCode",{parentName:"p"},"${RELEASE_TAG}")," correctly filled."),(0,a.kt)("h2",{id:"kustomize"},"kustomize"),(0,a.kt)("h3",{id:"change-default-configuration"},"Change default configuration"),(0,a.kt)("p",null,"You can change default configuration editing the config files."),(0,a.kt)("p",null,"For example, to deploy the controller in another namespace, change the file ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kube-green/kube-green/blob/main/config/default/kustomization.yaml#L2"},"kustomization.yaml")," with the desired namespace name."),(0,a.kt)("h3",{id:"deploy"},"Deploy"),(0,a.kt)("p",null,"To install ",(0,a.kt)("em",{parentName:"p"},"kube-green")," in the cluster, clone the repository and run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"make deploy\n")),(0,a.kt)("p",null,"This will create a new namespace, ",(0,a.kt)("em",{parentName:"p"},"kube-green"),", which contains the pod of the operator."),(0,a.kt)("h2",{id:"operator-lifecycle-manager-olm"},"Operator Lifecycle Manager (OLM)"),(0,a.kt)("h3",{id:"install-from-operatorhubio"},"Install from OperatorHub.io"),(0,a.kt)("p",null,"You can find ",(0,a.kt)("em",{parentName:"p"},"kube-green")," in the ",(0,a.kt)("a",{parentName:"p",href:"https://operatorhub.io/operator/kube-green"},"OperatorHub.io website"),". Click the Install button, and follow the instructions."),(0,a.kt)("h3",{id:"install-on-openshift"},"Install on OpenShift"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"kube-green")," is in the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.openshift.com/container-platform/4.9/operators/understanding/olm-rh-catalogs.html"},"Red Hat-provided Operator catalogs")," called community operators. On OpenShift 4 you can install ",(0,a.kt)("em",{parentName:"p"},"kube-green")," from ",(0,a.kt)("a",{parentName:"p",href:"https://docs.openshift.com/container-platform/4.9/operators/understanding/olm-understanding-operatorhub.html"},"OperatorHub"),". To install it, follow ",(0,a.kt)("a",{parentName:"p",href:"https://docs.openshift.com/container-platform/4.9/operators/admin/olm-adding-operators-to-cluster.html"},"this guide"),"."),(0,a.kt)("h2",{id:"cloud-compatibility"},"Cloud compatibility"),(0,a.kt)("h3",{id:"gke"},"GKE"),(0,a.kt)("p",null,"When Google configure the control plane for private cluster, they automatically configure VPC peering between your Kubernetes cluster network and a separate Google managed project."),(0,a.kt)("p",null,"To restrict what Google is able to access in your cluster, the firewall rules configured restrict access to your Kubernetes pods. This means that the webhook won't work, and you see an error like ",(0,a.kt)("inlineCode",{parentName:"p"},"Internal error occurred: failed calling webhook ...:")),(0,a.kt)("p",null,"So, to use the webhook component with a GKE private cluster, you need to configure an additional firewall rule to allow the GKE control plane to access to your webhook pod."),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"kube-green")," uses webhook (exposed on port 9443) to check that SleepInfo CRD is valid. In order to make it works, you must open the 9443 port (or change the exposed port by configuration) otherwise it would not possible to add SleepInfo CRD."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters#add_firewall_rules"},"Here")," you can read more information about how to add firewall rules to GKE."),(0,a.kt)("h3",{id:"aws-eks"},"AWS EKS"),(0,a.kt)("p",null,"When using a custom CNI on EKS (such as cilium), the webhook cannot be reached by kube-green. This happens because the control plane cannot be configured to run on a custom CNI, so the CNIs differ between control plane and worker nodes."),(0,a.kt)("p",null,"To address this, set ",(0,a.kt)("inlineCode",{parentName:"p"},"hostNetwork: true")," in the deployment of the webhook to run it in the host network."),(0,a.kt)("p",null,"To set this, uncomment the\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"# - host_network_patch.yaml")," line (",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kube-green/kube-green/blob/main/config/default/kustomization.yaml#L47"},"here"),") to apply the patch with the ",(0,a.kt)("inlineCode",{parentName:"p"},"hostNetwork: true")," value."))}d.isMDXComponent=!0}}]);